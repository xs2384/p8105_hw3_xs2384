---
title: "HW3"
output: github_document
author: Xinyu Shen
---


```{r}
library(tidyverse)
library(p8105.datasets)
data("instacart")

```

The dataset instacart has dimention of `r dim(instacart)[1]` X `r dim(instacart)[2]`. It has `r dim(instacart)[1]` variables, which are `r names(instacart)`. The key variables is the product_name, which help us to locate the product we want. The product_id variable can help us easily count how many such products were purchased, so it is important as well. For example, if the seller want to know how popular the spring water is, the seller can use the product name to locate the product and get its product id. Then the seller can count how many times this product id shows in the datasets, to know how popular the product is. 

```{r}
aisles_count = length(unique(pull(instacart, "aisle")))
df_most_item_aisle = instacart %>% group_by(aisle_id) %>% summarize(n=n()) 
most_item_aisle=max(df_most_item_aisle$n)
most_aisle_id = df_most_item_aisle$aisle_id[which(df_most_item_aisle$n==max(most_item_aisle))]
most_aisle_name = filter(instacart, aisle_id == most_aisle_id)[["aisle"]][1]
```

```{r}
df_item_aisles = instacart %>% group_by(aisle) %>% summarize(n=n()) 
item_plot = filter(df_item_aisles, n>10000) %>% mutate( 
  aisle= as.ordered(aisle)
  )
ggplot(item_plot, aes(x= aisle, y= n )) + geom_bar(stat = "identity")+ ylab("number in aisles") + coord_flip() +
  scale_x_discrete(limits = rev(levels(item_plot$aisle)))
```


```{r, message=FALSE, warning=FALSE}
df_three_most = instacart %>% filter(aisle %in% c("baking ingredients", "dog food care","packaged vegetables fruits")) %>% group_by(aisle, product_name) %>% summarize(num_times=n()) %>% arrange(-num_times, .by_group = TRUE) %>% top_n(3)
df_three_most
```
```{r}
df_p_c = instacart %>% filter(product_name %in% c('Pink Lady Apples', 'Coffee Ice Cream')) %>% select(product_name,order_dow, order_hour_of_day) %>% group_by(product_name, order_dow) %>% summarize(mean = mean(order_hour_of_day)) %>% pivot_wider(names_from = order_dow, values_from = mean) 
df_p_c
```

```{r}
data("brfss_smart2010") 
df_ptwo = brfss_smart2010 %>% janitor::clean_names() %>% select("state" = locationabbr, "county" = locationdesc, everything()) %>% filter(topic == "Overall Health") %>% mutate(
  response = factor(response, levels = rev(unique(response)))
)

df_2002 = filter(df_ptwo, year == 2002) %>% group_by(state,county) %>% summarize(obs_n = n()) %>% select(state,county) %>% ungroup() %>% group_by(state) %>% summarize(n=n())%>% filter(n >= 7)
df_2010 = filter(df_ptwo, year == 2010) %>% group_by(state,county) %>% summarize(obs_n = n()) %>% select(state,county) %>% ungroup() %>% group_by(state) %>% summarize(n=n())%>% filter(n >= 7)
df_2002
df_2010
```

In 2002, `r df_2002[["state"]]` were observed 7 or more locations, and in 2010, `r df_2010[["state"]]` were observed 7 or more locations. 

```{r, warning=FALSE, message=FALSE}
df_pthree = df_ptwo %>% filter(response == "Excellent") %>% group_by(year, state) %>% summarize(data_mean = mean(data_value)) %>% ungroup()

ggplot(df_pthree, aes(x= year, y= data_mean)) + geom_line(aes(color = state))

```

